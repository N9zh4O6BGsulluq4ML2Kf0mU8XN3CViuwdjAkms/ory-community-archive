<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>&ldquo;No CSRF value available in the session cookie&rdquo;: Chrome on Samsung, ideas? Nothing changed</title>
    <link rel="stylesheet" href="../../../archived.css" />
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  </head>
  
  <body>
    <header class="header">
      <div class="title-span">
        <a href="../../../">
          <img src="../../../images/site-logo.png" height="66" alt="ORY Community" id="site-logo" />
        </a>
      </div>
    </header>

    <div class="main">
    <h3>This is an archive of the community.ory.sh Discourse which is read-only.</h3>
It has been moved to GitHub Discussions, refer here:
<br><br>
<a href="https://github.com/ory/kratos/discussions">ORY Kratos Discussions</a><br>
<a href="https://github.com/ory/hydra/discussions">ORY Hydra Discussions</a><br>
<a href="https://github.com/ory/oathkeeper/discussions">ORY Oathkeeper Discussions</a><br>
<a href="https://github.com/ory/keto/discussions">ORY Keto Discussions</a><br>

    <h1 class="topic-title">&ldquo;No CSRF value available in the session cookie&rdquo;: Chrome on Samsung, ideas? Nothing changed</h1>
            <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/260_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">ghenry</div>
          <div class="post_content">
<p>Hi all,</p>
<p>Reading this:</p>
<aside class="onebox githubpullrequest">
<header class="source">
<a href="https://github.com/ory/hydra/pull/1813/commits/d1b66147670e62b05d75fa47ad149ab5348d922e" rel="nofollow noopener" target="_blank">github.com/ory/hydra</a>
</header>
<article class="onebox-body">
<div class="github-row">
<div class="github-icon-container" title="Pull Request">
<svg aria-hidden="true" class="github-icon" height="60" viewbox="0 0 12 16" width="60"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
</div>
<div class="github-info-container">
<h4>
<a href="https://github.com/ory/hydra/pull/1813" rel="nofollow noopener" target="_blank">docs: add CSRF section to debug</a>
</h4>
<div class="branches">
<code>ory:master</code> ← <code>ory:csrf-guidance</code>
</div>
<div class="github-info">
<div class="date">
        opened <span class="discourse-local-date" data-date="2020-04-22" data-format="ll" data-time="09:28:10" data-timezone="UTC">09:28AM - 22 Apr 20 UTC</span>
</div>
<div class="user">
<a href="https://github.com/aeneasr" rel="nofollow noopener" target="_blank">
<img alt="aeneasr" class="onebox-avatar-inline" height="20" src="../../../images/936076922415beed8a112b37d618a07cd1b5c9c1.png" width="20"/>
          aeneasr
        </a>
</div>
<div class="lines" title="1 commits changed 1 files with 23 additions and 2 deletions">
<a href="https://github.com/ory/hydra/pull/1813/files" rel="nofollow noopener" target="_blank">
<span class="added">+23</span>
<span class="removed">-2</span>
</a>
</div>
</div>
</div>
</div>
</article>
<div class="onebox-metadata">
</div>
<div style="clear: both"></div>
</aside>
<p>and I’ve changed nothing on my side or test devices which all use AppAuth. All of a sudden my own phone is returning this.</p>
<p>I’m running Hydra behind Apache Reverse Proxy with HTTPS / LE and have been for months all fine.</p>
<p>Haven’t changed any settings on the Chrome browser on my mobile. So strange!!!</p>
<p>Thanks.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/260_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">ghenry</div>
          <div class="post_content">
<p>Rebooted phone and cleared cache etc. in Chrome.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/5_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">hackerman</div>
          <div class="post_content">
<p>Without details on logs, browser debug information, and other details I won’t be able to help. We haven’t changed things in CSRF though for quite some time. The last change was SameSite cookies</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/260_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">ghenry</div>
          <div class="post_content">
<p>Yeah, I just change browser. Will investigate again if users report it.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/260_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">ghenry</div>
          <div class="post_content">
<p>Just hit this again on a fresh Android 11 simulator with an up to date Chrome browser. What info do you need?</p>
<p>Thanks.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/260_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">ghenry</div>
          <div class="post_content">
<p>On latest hydra.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/260_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">ghenry</div>
          <div class="post_content">
<p>Hydra logs:</p>
<pre><code>hydra_1          | time="2020-07-29T12:54:32Z" level=info msg="completed handling request" measure#hydra/public: https://authz.testing.co.uk/.latency=5095151 method=GET remote="172.18.0.1:35382" request="/oauth2/auth?redirect_uri=com.testing.talk%3A%2Foauth2redirect&amp;client_id=asd1745-efc-4as3c9323-f1c6885eba5e&amp;response_type=code&amp;login_hint=ghenry%40testing.co.uk&amp;state=QfAb1Frf_kDT-tgMMGaVyA&amp;scope=openid%20offline&amp;code_challenge=Z_H6UNn9JdE9VcaDvJL7H4GBvDsVoRKvyIcz341X1ww&amp;code_challenge_method=S256" status=302 text_status=Found took=5.095151ms
hydra_1          | time="2020-07-29T12:54:32Z" level=info msg="started handling request" method=GET remote="172.18.0.1:37466" request="/oauth2/auth/requests/login?login_challenge=92112c5f0bed40348c7604d8d4a063ab"
hydra_1          | time="2020-07-29T12:54:32Z" level=info msg="completed handling request" measure#hydra/admin: https://authz.testing.co.uk/.latency=1459139 method=GET remote="172.18.0.1:37466" request="/oauth2/auth/requests/login?login_challenge=92112c5f0bed40348c7604d8d4a063ab" status=200 text_status=OK took=1.459139ms
hydra_1          | time="2020-07-29T12:54:37Z" level=info msg="started handling request" method=PUT remote="172.18.0.1:37508" request="/oauth2/auth/requests/login/accept?login_challenge=92112c5f0bed40348c7604d8d4a063ab"
hydra_1          | time="2020-07-29T12:54:37Z" level=info msg="completed handling request" measure#hydra/admin: https://authz.testing.co.uk/.latency=6018886 method=PUT remote="172.18.0.1:37508" request="/oauth2/auth/requests/login/accept?login_challenge=92112c5f0bed40348c7604d8d4a063ab" status=200 text_status=OK took=6.018886ms
hydra_1          | time="2020-07-29T12:54:37Z" level=info msg="started handling request" method=GET remote="172.18.0.1:35382" request="/oauth2/auth?client_id=asd1745-efc-4as3c9323-f1c6885eba5e&amp;code_challenge=Z_H6UNn9JdE9VcaDvJL7H4GBvDsVoRKvyIcz341X1ww&amp;code_challenge_method=S256&amp;login_hint=ghenry%40testing.co.uk&amp;login_verifier=5c84ef04d51348a395f01ceb218bbc41&amp;redirect_uri=com.testing.talk%3A%2Foauth2redirect&amp;response_type=code&amp;scope=openid+offline&amp;state=QfAb1Frf_kDT-tgMMGaVyA"
hydra_1          | time="2020-07-29T12:54:37Z" level=error msg="An error occurred" debug="No CSRF value available in the session cookie" description="The request is not allowed" error=request_forbidden hint="You are not allowed to perform this action."
hydra_1          | time="2020-07-29T12:54:37Z" level=debug msg="Stack trace: \ngithub.com/ory/hydra/consent.validateCsrfSession\n\t/home/ory/consent/helper.go:85\ngithub.com/ory/hydra/consent.(*DefaultStrategy).verifyAuthentication\n\t/home/ory/consent/strategy_default.go:352\ngithub.com/ory/hydra/consent.(*DefaultStrategy).HandleOAuth2AuthorizationRequest\n\t/home/ory/consent/strategy_default.go:970\ngithub.com/ory/hydra/oauth2.(*Handler).AuthHandler\n\t/home/ory/oauth2/handler.go:624\ngithub.com/julienschmidt/httprouter.(*Router).ServeHTTP\n\t/go/pkg/mod/github.com/julienschmidt/httprouter@v1.2.0/router.go:334\ngithub.com/urfave/negroni.Wrap.func1\n\t/go/pkg/mod/github.com/urfave/negroni@v1.0.0/negroni.go:46\ngithub.com/urfave/negroni.HandlerFunc.ServeHTTP\n\t/go/pkg/mod/github.com/urfave/negroni@v1.0.0/negroni.go:29\ngithub.com/urfave/negroni.middleware.ServeHTTP\n\t/go/pkg/mod/github.com/urfave/negroni@v1.0.0/negroni.go:38\nnet/http.HandlerFunc.ServeHTTP\n\t/usr/local/go/src/net/http/server.go:2012\ngithub.com/ory/hydra/x.RejectInsecureRequests.func1\n\t/home/ory/x/tls_termination.go:55\ngithub.com/urfave/negroni.HandlerFunc.ServeHTTP\n\t/go/pkg/mod/github.com/urfave/negroni@v1.0.0/negroni.go:29\ngithub.com/urfave/negroni.middleware.ServeHTTP\n\t/go/pkg/mod/github.com/urfave/negroni@v1.0.0/negroni.go:38\ngithub.com/ory/x/metricsx.(*Service).ServeHTTP\n\t/go/pkg/mod/github.com/ory/x@v0.0.111/metricsx/middleware.go:261\ngithub.com/urfave/negroni.middleware.ServeHTTP\n\t/go/pkg/mod/github.com/urfave/negroni@v1.0.0/negroni.go:38\ngithub.com/ory/hydra/metrics/prometheus.(*MetricsManager).ServeHTTP\n\t/home/ory/metrics/prometheus/middleware.go:26\ngithub.com/urfave/negroni.middleware.ServeHTTP\n\t/go/pkg/mod/github.com/urfave/negroni@v1.0.0/negroni.go:38\ngithub.com/ory/x/reqlog.(*Middleware).ServeHTTP\n\t/go/pkg/mod/github.com/ory/x@v0.0.111/reqlog/middleware.go:140\ngithub.com/urfave/negroni.middleware.ServeHTTP\n\t/go/pkg/mod/github.com/urfave/negroni@v1.0.0/negroni.go:38\ngithub.com/urfave/negroni.(*Negroni).ServeHTTP\n\t/go/pkg/mod/github.com/urfave/negroni@v1.0.0/negroni.go:96\nnet/http.serverHandler.ServeHTTP\n\t/usr/local/go/src/net/http/server.go:2807\nnet/http.(*conn).serve\n\t/usr/local/go/src/net/http/server.go:1895\nruntime.goexit\n\t/usr/local/go/src/runtime/asm_amd64.s:1373"
hydra_1          | time="2020-07-29T12:54:37Z" level=info msg="completed handling request" measure#hydra/public: https://authz.testing.co.uk/.latency=6143421 method=GET remote="172.18.0.1:35382" request="/oauth2/auth?client_id=asd1745-efc-4as3c9323-f1c6885eba5e&amp;code_challenge=Z_H6UNn9JdE9VcaDvJL7H4GBvDsVoRKvyIcz341X1ww&amp;code_challenge_method=S256&amp;login_hint=ghenry%40testing.co.uk&amp;login_verifier=5c84ef04d51348a395f01ceb218bbc41&amp;redirect_uri=com.testing.talk%3A%2Foauth2redirect&amp;response_type=code&amp;scope=openid+offline&amp;state=QfAb1Frf_kDT-tgMMGaVyA" status=302 text_status=Found took=6.143421ms
hydra_1          | time="2020-07-29T12:54:37Z" level=info msg="started handling request" method=GET remote="172.18.0.1:35382" request="/oauth2/fallbacks/error?error=request_forbidden&amp;error_debug=No+CSRF+value+available+in+the+session+cookie&amp;error_description=The+request+is+not+allowed&amp;error_hint=You+are+not+allowed+to+perform+this+action."
hydra_1          | time="2020-07-29T12:54:37Z" level=warning msg="A client requested the default error URL, environment variable OAUTH2_ERROR_URL is probably not set."
hydra_1          | time="2020-07-29T12:54:37Z" level=info msg="completed handling request" measure#hydra/public: https://authz.testing.co.uk/.latency=380714 method=GET remote="172.18.0.1:35382" request="/oauth2/fallbacks/error?error=request_forbidden&amp;error_debug=No+CSRF+value+available+in+the+session+cookie&amp;error_description=The+request+is+not+allowed&amp;error_hint=You+are+not+allowed+to+perform+this+action." status=500 text_status="Internal Server Error" took="380.714µs"</code></pre>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/260_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">ghenry</div>
          <div class="post_content">
<p>You could try this out by downloading Android Studio:</p>
<p><a class="onebox" href="https://developer.android.com/studio" rel="nofollow noopener" target="_blank">https://developer.android.com/studio</a></p>
<p>Then go to Tools -&gt; AVD Manager then Create Virtual Device to create an Android phone. Log in to Play Store with an account, update Chrome and then visit a Hydra backed website/app etc.</p>
<p>Thanks.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/260_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">ghenry</div>
          <div class="post_content">
<p>Working Android 10 with Firefox:</p>
<pre><code>[29/Jul/2020:15:36:54 +0100] "GET /oauth2/auth?redirect_uri=com.testing.talk%3A%2Foauth2redirect&amp;client_id=9323-f1c6885eba5e&amp;response_type=code&amp;login_hint=ghenry%40testing.co.uk&amp;state=g6Epg6capgPQd3PvwVH7wA&amp;scope=openid%20offline&amp;code_challenge=HzONZ6WZVFTLQgRmpzFXuUeKDnm2OuuykBYIgez_uSU&amp;code_challenge_method=S256 HTTP/1.1" 302 107 "-" "Mozilla/5.0 (Android 10; Mobile; rv:68.0) Gecko/68.0 Firefox/68.0"
[29/Jul/2020:15:36:59 +0100] "GET /oauth2/auth?client_id=9323-f1c6885eba5e&amp;code_challenge=HzONZ6WZVFTLQgRmpzFXuUeKDnm2OuuykBYIgez_uSU&amp;code_challenge_method=S256&amp;login_hint=ghenry%40testing.co.uk&amp;login_verifier=32d29a635cf74e3eabe6124ff9943ae7&amp;redirect_uri=com.testing.talk%3A%2Foauth2redirect&amp;response_type=code&amp;scope=openid+offline&amp;state=g6Epg6capgPQd3PvwVH7wA HTTP/1.1" 302 111 "https://portal.testing.co.uk/login?login_challenge=5f3bc29480944df69ff57136d1f13ac6" "Mozilla/5.0 (Android 10; Mobile; rv:68.0) Gecko/68.0 Firefox/68.0"
[29/Jul/2020:15:36:59 +0100] "GET /oauth2/auth?client_id=9323-f1c6885eba5e&amp;code_challenge=HzONZ6WZVFTLQgRmpzFXuUeKDnm2OuuykBYIgez_uSU&amp;code_challenge_method=S256&amp;consent_verifier=e94b16a44e8e49808487769d72123317&amp;login_hint=ghenry%40testing.co.uk&amp;redirect_uri=com.testing.talk%3A%2Foauth2redirect&amp;response_type=code&amp;scope=openid+offline&amp;state=g6Epg6capgPQd3PvwVH7wA HTTP/1.1" 302 - "https://portal.testing.co.uk/login?login_challenge=5f3bc29480944df69ff57136d1f13ac6" "Mozilla/5.0 (Android 10; Mobile; rv:68.0) Gecko/68.0 Firefox/68.0"
[29/Jul/2020:15:37:00 +0100] "POST /oauth2/token HTTP/1.1" 200 1649 "-" "Dalvik/2.1.0 (Linux; U; Android 10; SM-G970F Build/QP1A.190711.020)"
</code></pre>
<p>Android 11, Chrome up to date.</p>
<pre><code>[29/Jul/2020:15:38:02 +0100] "GET /oauth2/auth?redirect_uri=com.testing.talk%3A%2Foauth2redirect&amp;client_id=9323-f1c6885eba5e&amp;response_type=code&amp;login_hint=ghenry%40testing.co.uk&amp;state=IgvZOAhsh8YaCcFw_vnaSw&amp;scope=openid%20offline&amp;code_challenge=ewLWCgvE6rOPKp88r-Oz6y1yMYOq_K_G1Gnr9PR9eXw&amp;code_challenge_method=S256 HTTP/1.1" 302 107 "-" "Mozilla/5.0 (Linux; Android 11; sdk_gphone_x86) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Mobile Safari/537.36"
[29/Jul/2020:15:38:09 +0100] "GET /oauth2/auth?client_id=9323-f1c6885eba5e&amp;code_challenge=ewLWCgvE6rOPKp88r-Oz6y1yMYOq_K_G1Gnr9PR9eXw&amp;code_challenge_method=S256&amp;login_hint=ghenry%40testing.co.uk&amp;login_verifier=61dc1fc565a542eca8ccc8e516ca684d&amp;redirect_uri=com.testing.talk%3A%2Foauth2redirect&amp;response_type=code&amp;scope=openid+offline&amp;state=IgvZOAhsh8YaCcFw_vnaSw HTTP/1.1" 302 268 "https://portal.testing.co.uk/login?login_challenge=06c9086cc29449a3bf055f05d764a668" "Mozilla/5.0 (Linux; Android 11; sdk_gphone_x86) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Mobile Safari/537.36"
[29/Jul/2020:15:38:09 +0100] "GET /oauth2/fallbacks/error?error=request_forbidden&amp;error_debug=No+CSRF+value+available+in+the+session+cookie&amp;error_description=The+request+is+not+allowed&amp;error_hint=You+are+not+allowed+to+perform+this+action. HTTP/1.1" 500 647 "https://portal.testing.co.uk/login?login_challenge=06c9086cc29449a3bf055f05d764a668" "Mozilla/5.0 (Linux; Android 11; sdk_gphone_x86) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Mobile Safari/537.36"</code></pre>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/260_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">ghenry</div>
          <div class="post_content">
<p>If I switch my default browser to a freshly installed Firefox on the Android 11 device, all is good and works.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/5_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">hackerman</div>
          <div class="post_content">
<p>Are you using the <code>--dangerous-force-http</code> flag? Chrome rejects cookies with <code>SameSite=none</code> that do not have the secure flag, which is the case when using that option.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/260_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">ghenry</div>
          <div class="post_content">
<p>Yeah, I see in v1.7.0 this is mentioned. I’ll remove that and re-test as Firefox is next.</p>
<p>Thanks and apologies for not coming back sooner.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/5_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">hackerman</div>
          <div class="post_content">
<p>No problem, glad we were able to get to the root of the problem!</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/260_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">ghenry</div>
          <div class="post_content">
<p>Chome is working fine now. Great. Still have http on though, but not in production yet.</p>
          </div>
        </div>
      </div>


    </div>
  </body>
</html>
